function newFunction(n,t){var i,r,u;n.id===amendmentId&&(i=arrayFirstIndexOf(t.amendments(),function(t){return t.id()===n.id}),i>-1?(r=t.amendments()[i],u=convertToObservable(n),t.amendments.replace(r,u)):t.amendments.push(convertToObservable(n)))}var AmendmentModel=function(n){var i=ManageAmendmentHub(),t=this,r,f;t.amendments=ko.observableArray();t.amendBody=ko.observable(n.amendBody);t.amendBodyId=amendBodyId;t.ShowDeafSigner=ko.observable("0");t.ShowDeafSignerBox=ko.observable("0");t.page=ko.observable(-1);r=!1;t.amendBodyPages=ko.computed(function(){return t.amendBody()?{amendBodyPages:t.amendBody().split("**NEWSLIDE**").map(function(n){return marked(n,{breaks:!0})})}:{amendBodyPages:[""]}});i.on("amendment.amendmentReturn",function(n){newFunction(n,t)});$(document).on("amendment.amendmentChange",function(n,i){newFunction(i.data,t)});$(document).on("amendment.ready",function(){i.invoke("getAmendment",amendmentId);i.invoke("getSystemSetting","ShowDeafSigner");i.invoke("getSystemSetting","ShowDeafSignerBox")});$(document).on("amendment.reconnect",function(){i.invoke("getAmendment",amendmentId);i.invoke("getSystemSetting","ShowDeafSigner");i.invoke("getSystemSetting","ShowDeafSignerBox")});i.on("RefreshSetting",function(n){updateSetting(t,n)});t.onSaveClicked=function(){return r=!0,!0};$(document).on("amendment.amendmentBodyChange",function(n,i){var h=i.data.amendId,f,u,e,o,s;if(i.data.id!==t.amendBodyId||r||$("#concurrencyWarning").removeClass("hidden"),f=arrayFirstIndexOf(t.amendments(),function(n){return n.id()===h}),f!==-1){u=t.amendments()[f];switch(i.results.operationType){case 1:u.amendmentBodies.push(convertToObservable(i.data));break;case 2:e=arrayFirstIndexOf(u.amendmentBodies(),function(n){return n.id()===i.id});e>-1&&(o=u.amendmentBodies()[e],s=convertToObservable(i.data),u.amendmentBodies.replace(o,s));break;case 3:u.amendmentBodies.remove(function(n){return n.id()===i.id})}}});let e=$(".markdown-editor");if(e.length>0){t.editor=new SimpleMDE({element:e[0],forceSync:!0,spellChecker:!1,hideIcons:["guide","preview","side-by-side","fullscreen"],showIcons:["strikethrough"]});t.editor.codemirror.on("change",function(){t.amendBody($("#AmendBody").val())})}$("#insertPage").click(function(){var n=t.editor.codemirror.getCursor();t.editor.codemirror.setSelection(n,n);t.editor.codemirror.replaceSelection("**NEWSLIDE**")});const u=(new signalR.HubConnectionBuilder).withUrl("/diffHub?pageUrlHash="+window.PageUrlHash).build();u.on("receivePatch",n=>{console.log("receivePatch",n)});u.start();f=t.amendBody()||"";t.amendBody.subscribe(function(n){var t=new diff_match_patch,r=t.diff_main(f,n),e=t.patch_make(r),i=t.patch_toText(e);u.invoke("xmitPatch",window.PageUrlHash,i);console.log(i);f=n})};ko.applyBindings(new AmendmentModel(initialData));