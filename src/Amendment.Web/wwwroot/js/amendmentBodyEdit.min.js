function newFunction(n,t){var i,r,u;n.id===amendmentId&&(i=arrayFirstIndexOf(t.amendments(),function(t){return t.id()===n.id}),i>-1?(r=t.amendments()[i],u=convertToObservable(n),t.amendments.replace(r,u)):t.amendments.push(convertToObservable(n)))}var AmendmentModel=function(n){var i=ManageAmendmentHub(),t=this;t.amendments=ko.observableArray();t.amendBody=ko.observable(n.amendBody);t.page=ko.observable(-1);t.amendBodyPages=ko.computed(function(){return{amendBodyPages:t.amendBody().split("**NEWPAGE**").map(function(n){return marked(n,{breaks:!0})})}});i.on("amendment.amendmentReturn",function(n){newFunction(n,t)});$(document).on("amendment.amendmentChange",function(n,i){newFunction(i.data,t)});$(document).on("amendment.ready",function(){i.invoke("getAmendment",amendmentId)});$(document).on("amendment.amendmentBodyChange",function(n,i){var f,u,r,e,o;if(console.log(i),f=i.data.amendId,r=arrayFirstIndexOf(t.amendments(),function(n){return n.id()===f}),r!==-1){u=t.amendments()[r];switch(i.results.operationType){case 1:u.amendmentBodies.push(convertToObservable(i.data));break;case 2:r=arrayFirstIndexOf(u.amendmentBodies(),function(n){return n.id()===i.id});r>-1&&(e=u.amendmentBodies()[r],o=convertToObservable(i.data),u.amendmentBodies.replace(e,o));break;case 3:u.amendmentBodies.remove(function(n){return n.id()===i.id})}}});$("#insertPage").click(function(){insertAtCaret("AmendBody","**NEWPAGE**")})};ko.applyBindings(new AmendmentModel(initialData));