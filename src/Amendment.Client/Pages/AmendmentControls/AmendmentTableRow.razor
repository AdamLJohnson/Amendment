@using Amendment.Shared.Responses
@using Amendment.Client.Repository
@inject IAmendmentRepository AmendmentRepository
<TableRow>
    <TableRowCell>
        @Model.Title
        @if (Model.IsLive)
        {
            <div style="float: right!important">
                <Badge Color="Color.Danger">LIVE</Badge>
            </div>
        }
    </TableRowCell>
    <TableRowCell>@Model.Author</TableRowCell>
    <TableRowCell>@Model.Motion</TableRowCell>
    <TableRowCell>
        <Badge Background="Background.Light" TextColor="TextColor.Black50">English</Badge>
        <Badge Background="Background.Light" TextColor="TextColor.Black50">Spanish</Badge>
        <Badge Background="Background.Light" TextColor="TextColor.Black50">French</Badge>
    </TableRowCell>
    <TableRowCell TextAlignment="TextAlignment.Center">

        @if (Model.IsLive)
        {
            <Button Color="Color.Success">Control Screens</Button> 
        }
        @if ((LiveAmendmentId ?? 0) == 0)
        {
            <Button Color="Color.Warning">Go Live</Button> 
        }
        <span></span>
        <Button Color="Color.Primary" Type="ButtonType.Link" To=@($"/Amendment/Edit/{Model.Id}")>Edit</Button>
        <span></span>
        @if (!Model.IsLive)
        {
            <Button Color="Color.Danger" Clicked="() => modalRef.Show()">Delete</Button>
        }
    </TableRowCell>
</TableRow>

<Modal @ref="@modalRef">
    <ModalContent Centered>
        <ModalHeader>
            <ModalTitle>Delete Amendment</ModalTitle>
            <CloseButton />
        </ModalHeader>
        <ModalBody>
            Are you sure you want to delete this amendment?
        </ModalBody>
        <ModalFooter>
            <Button Color="Color.Secondary" Clicked="() => modalRef.Hide()">Close</Button>
            <Button Color="Color.Primary" Clicked="OnDeleteBtn">Save Changes</Button>
        </ModalFooter>
    </ModalContent>
</Modal>

@code {
    [Parameter]
    public AmendmentResponse Model { get; set; }

    [Parameter]
    public EventCallback OnDelete { get; set; }

    [Parameter]
    public int? LiveAmendmentId { get; set; }

    private Modal? modalRef;

    private async Task OnDeleteBtn()
    {
        await AmendmentRepository.DeleteAsync(Model.Id);
        await modalRef.Hide();
        OnDelete.InvokeAsync();
    }

}
